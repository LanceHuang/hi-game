> 网络层：以前web是一次请求，一次返回，服务器不会主动向浏览器推送数据。游戏项目一般都是长连接，服务器可以随时向玩家推送消息，广播、交易申请什么的。

### 项目结构
```
ClientA -----------> +------------+         +------------+
                     |            | ------> |            | ----> XXController  
ClientB -----------> |   net      |         | dispatcher |
                     |            |         +------------+
ClientC -----------> +------------+ <--------------------------- AnyWhere
```
* net：只接收和响应协议，其中协议解析有专门的handler
* dispatcher：按玩家账号取模，可以保证玩家操作的并发安全；按地图块id取模，可以保证地图块内并发安全
* XXController：类似于SpringMVC的Controller
* AnyWhere：提供一个工具类，可以从任何地方回传协议（活动Handler、广播Service、业务Service）

### 设计思路
1. 连接时，用Session记录连接信息
2. 玩家登录时，将玩家信息记录到Session上
3. 响应时，获取Session，并响应请求
4. 请求/响应都用“协议”，协议属于实体类，有协议号

1. **方案一**：stateless，每次客户端请求都携带账号，服务端用Context记录（纯BIO/NIO）
2. **方案二**：之所以Web要用Cookie，是因为每次HTTP后都会断开连接，游戏一般都是长连接，没必要这样处理

### 需要解决的问题
1. 怎么保证玩家在同一条线程？上面dispatcher能保证同一玩家的协议在同一线程，但不能保证响应也在同一线程


